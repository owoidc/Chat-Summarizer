# 📚 Chat Summarizer - 聊天总结器

**SillyTavern 插件**

一个专注于聊天记录总结的轻量级插件,提取自 [ST-Memory-Context](https://github.com/gaigai315/ST-Memory-Context) 项目。

---

## ✨ 核心功能

### 1. 🤖 智能总结生成

- **手动总结**: 随时一键生成当前聊天的总结
- **自动总结**: 设置消息间隔,自动触发总结生成
- **分批处理**: 长对话自动分批总结再汇总,确保质量
- **自定义提示词**: 完全控制总结的风格和格式

### 2. 📊 灵活的显示方式

- **聊天内显示**: 总结可直接显示在聊天界面
- **位置选择**: 顶部或底部显示
- **弹窗查看**: 独立窗口查看完整总结
- **美观界面**: 现代化UI设计,与酒馆完美融合

### 3. 💾 数据管理

- **自动保存**: 总结随聊天文件保存,多端同步
- **导出功能**: 一键导出总结为txt文件
- **历史记录**: 记录每次总结的时间和消息数

---

## 🚀 安装方法

### 方法一: URL 安装 (推荐)

1. 打开 SillyTavern
2. 点击 **扩展 (Extensions)** 图标
3. 点击 **安装扩展 (Install Extension)**
4. 粘贴仓库地址并安装

### 方法二: 手动安装

1. 下载本仓库
2. 解压到 `SillyTavern/data/default-user/extensions/third-party/chat-summarizer`
3. 重启 SillyTavern

---

## 📖 使用指南

### 基础使用

1. **启用插件**: 在扩展设置中找到"聊天总结器",勾选"启用聊天总结"
2. **生成总结**: 点击"生成总结"按钮,等待AI生成
3. **查看结果**: 总结会显示在聊天界面或通过"查看总结"按钮查看

### 自动总结

1. 勾选"自动生成总结"
2. 设置"总结间隔"(建议 20-50 条消息)
3. 聊天时插件会自动在达到间隔后生成总结

### 自定义提示词

插件提供了多种提示词模板:

**简洁版** - 适合快速浏览:
```
请用3-5句话总结以下对话的核心内容:

{{messages}}
```

**详细版** - 适合深度分析:
```
请详细总结以下对话,包括:
1. 主要讨论的话题
2. 重要的事件和转折
3. 角色的情感变化
4. 未解决的问题

{{messages}}
```

**结构化版** - 适合条理化记录:
```
分析以下对话并生成结构化总结:

【背景】简述对话背景
【关键事件】列出重要事件(时间顺序)
【角色发展】描述主要角色的状态变化
【待办事项】提取未完成的任务或承诺
【总结】一句话概括

{{messages}}
```

---

## 🎨 使用场景

### 🎮 RPG 游戏
使用"事件日志"风格的提示词,记录冒险历程:
```
作为地下城主,请整理本次冒险的事件日志:

冒险记录:
{{messages}}

请按时间顺序列出关键事件、战斗结果、获得物品和重要决策。
```

### 📚 学习对话
使用"知识要点"风格,提取学习重点:
```
请从以下学习对话中提取知识要点:

对话内容:
{{messages}}

请整理成:
1. 核心概念
2. 重要公式/定义
3. 示例说明
4. 需要复习的内容
```

### ✍️ 故事创作
使用"剧情大纲"风格,梳理故事线:
```
请为以下故事对话生成剧情大纲:

故事内容:
{{messages}}

大纲包括:
- 场景: 时间、地点、氛围
- 角色: 出场人物及其状态
- 情节: 主要事件的起承转合
- 伏笔: 未解之谜和后续线索
```

---

## ⚙️ 配置说明

### 总结设置

- **总结间隔**: 每N条新消息自动生成总结 (默认: 20)
- **批次大小**: 长对话分批处理的大小 (默认: 50)

### 显示设置

- **在聊天中显示**: 在聊天界面显示总结内容
- **显示位置**: 顶部或底部

### 高级设置

- **自定义提示词**: 使用 `{{messages}}` 作为消息占位符
- **批次处理**: 超过批次大小的对话会自动分批总结

---

## 🔧 技术细节

### 工作原理

1. **消息收集**: 从聊天记录中提取非系统消息
2. **分批处理**: 
   - 单批: 直接总结
   - 多批: 分别总结后再汇总
3. **AI 生成**: 使用 `generateQuietPrompt()` 调用 AI
4. **结果保存**: 存储到扩展设置中,随聊天文件同步

### 数据结构

```javascript
{
  chatId: {
    timestamp: 1234567890,      // 生成时间
    content: "总结内容...",      // 总结文本
    messageCount: 42,            // 消息数量
    characterName: "角色名"      // 角色名称
  }
}
```

---

## 📝 与 ST-Memory-Context 的区别

| 功能 | Chat Summarizer | ST-Memory-Context |
|-----|----------------|-------------------|
| 聊天总结 | ✅ | ✅ |
| 记忆表格 | ❌ | ✅ |
| 隐藏楼层 | ❌ | ✅ |
| 插件大小 | ~10KB | ~50KB |
| 复杂度 | 低 | 高 |
| 适用场景 | 只需要总结功能 | 需要完整的记忆系统 |

**选择建议**:
- 如果你已经有其他表格插件,只需要总结功能 → 使用 **Chat Summarizer**
- 如果你需要完整的记忆管理系统 → 使用 **ST-Memory-Context**

---

## 🐛 故障排除

### 总结生成失败

**可能原因**:
1. 聊天记录为空
2. AI 接口未配置
3. 网络连接问题

**解决方法**:
1. 确保有至少几条聊天消息
2. 检查 SillyTavern 的 API 设置
3. 查看浏览器控制台的错误信息

### 总结不显示在聊天中

**检查**:
1. "在聊天中显示总结" 是否勾选
2. 是否已生成总结
3. 尝试切换显示位置

### 自动总结不触发

**检查**:
1. "自动生成总结" 是否勾选
2. 消息数是否达到设定间隔
3. 是否已生成过总结(会从上次总结后的消息开始计数)

---

## 📄 许可证

MIT License

---

## 🙏 致谢

本插件的核心功能提取自 [ST-Memory-Context](https://github.com/gaigai315/ST-Memory-Context) 项目,感谢 gaigai315 的优秀工作!

---

## 📧 反馈与支持

如有问题或建议,请在 GitHub 提交 Issue。

**享受更智能的聊天体验! 🎉**
<div id="chat_summarizer_container">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>ğŸ“š èŠå¤©è®°å½•æ€»ç»“å™¨</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <!-- ä¸»å¼€å…³ -->
            <div class="summarizer-section">
                <label class="checkbox_label" title="å¯ç”¨èŠå¤©æ€»ç»“åŠŸèƒ½">
                    <input type="checkbox" id="summarizer_enabled">
                    <span><strong>å¯ç”¨èŠå¤©æ€»ç»“</strong></span>
                </label>
            </div>

            <div id="summarizer_controls" style="display: none;">
                <!-- çŠ¶æ€æ˜¾ç¤º -->
                <div class="summarizer-section">
                    <div class="summarizer-status-box">
                        <i class="fa-solid fa-info-circle"></i>
                        <span id="summarizer_status">æš‚æ— æ€»ç»“</span>
                    </div>
                </div>

                <!-- è‡ªåŠ¨æ€»ç»“è®¾ç½® -->
                <div class="summarizer-section">
                    <h4><i class="fa-solid fa-magic"></i> è‡ªåŠ¨æ€»ç»“</h4>
                    
                    <label class="checkbox_label" title="æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶è‡ªåŠ¨è§¦å‘æ€»ç»“">
                        <input type="checkbox" id="summarizer_auto">
                        <span>è‡ªåŠ¨ç”Ÿæˆæ€»ç»“</span>
                    </label>

                    <div class="range-block">
                        <label for="summarizer_interval">
                            æ€»ç»“é—´éš” (æ¶ˆæ¯æ•°): 
                            <span id="summarizer_interval_value">20</span>
                        </label>
                        <input type="range" id="summarizer_interval" 
                               min="5" max="100" step="5" value="20" 
                               class="range-slider">
                        <small class="help-text">æ¯éš”Næ¡æ–°æ¶ˆæ¯è‡ªåŠ¨ç”Ÿæˆä¸€æ¬¡æ€»ç»“</small>
                    </div>

                    <div class="range-block">
                        <label for="summarizer_batch_size">
                            æ‰¹æ¬¡å¤§å° (æ¶ˆæ¯æ•°): 
                            <span id="summarizer_batch_size_value">50</span>
                        </label>
                        <input type="range" id="summarizer_batch_size" 
                               min="20" max="200" step="10" value="50" 
                               class="range-slider">
                        <small class="help-text">é•¿å¯¹è¯å°†åˆ†æ‰¹å¤„ç†,æ¯æ‰¹åŒ…å«Næ¡æ¶ˆæ¯</small>
                    </div>
                </div>

                <!-- æ˜¾ç¤ºè®¾ç½® -->
                <div class="summarizer-section">
                    <h4><i class="fa-solid fa-eye"></i> æ˜¾ç¤ºè®¾ç½®</h4>
                    
                    <label class="checkbox_label" title="åœ¨èŠå¤©ç•Œé¢æ˜¾ç¤ºæ€»ç»“å†…å®¹">
                        <input type="checkbox" id="summarizer_show_in_chat">
                        <span>åœ¨èŠå¤©ä¸­æ˜¾ç¤ºæ€»ç»“</span>
                    </label>

                    <div class="flex-container alignitemscenter">
                        <label for="summarizer_position">æ˜¾ç¤ºä½ç½®:</label>
                        <select id="summarizer_position" class="flex1">
                            <option value="top">é¡¶éƒ¨</option>
                            <option value="bottom">åº•éƒ¨</option>
                        </select>
                    </div>
                </div>

                <!-- è‡ªå®šä¹‰æç¤ºè¯ -->
                <div class="summarizer-section">
                    <h4><i class="fa-solid fa-pen"></i> æ€»ç»“æç¤ºè¯</h4>
                    <small class="help-text">
                        ä½¿ç”¨ <code>{{messages}}</code> ä½œä¸ºæ¶ˆæ¯å†…å®¹çš„å ä½ç¬¦
                    </small>
                    <textarea id="summarizer_prompt" 
                              class="text_pole textarea_compact" 
                              rows="8" 
                              placeholder="è¾“å…¥è‡ªå®šä¹‰æ€»ç»“æç¤ºè¯..."></textarea>
                    
                    <details class="margin-bot-10px">
                        <summary>æç¤ºè¯ç¤ºä¾‹</summary>
                        <div class="example-prompts">
                            <p><strong>ç®€æ´ç‰ˆ:</strong></p>
                            <pre>è¯·ç”¨3-5å¥è¯æ€»ç»“ä»¥ä¸‹å¯¹è¯çš„æ ¸å¿ƒå†…å®¹:

{{messages}}</pre>
                            
                            <p><strong>è¯¦ç»†ç‰ˆ:</strong></p>
                            <pre>è¯·è¯¦ç»†æ€»ç»“ä»¥ä¸‹å¯¹è¯,åŒ…æ‹¬:
1. ä¸»è¦è®¨è®ºçš„è¯é¢˜
2. é‡è¦çš„äº‹ä»¶å’Œè½¬æŠ˜
3. è§’è‰²çš„æƒ…æ„Ÿå˜åŒ–
4. æœªè§£å†³çš„é—®é¢˜

{{messages}}</pre>
                            
                            <p><strong>ç»“æ„åŒ–ç‰ˆ:</strong></p>
                            <pre>åˆ†æä»¥ä¸‹å¯¹è¯å¹¶ç”Ÿæˆç»“æ„åŒ–æ€»ç»“:

ã€èƒŒæ™¯ã€‘ç®€è¿°å¯¹è¯èƒŒæ™¯
ã€å…³é”®äº‹ä»¶ã€‘åˆ—å‡ºé‡è¦äº‹ä»¶(æ—¶é—´é¡ºåº)
ã€è§’è‰²å‘å±•ã€‘æè¿°ä¸»è¦è§’è‰²çš„çŠ¶æ€å˜åŒ–
ã€å¾…åŠäº‹é¡¹ã€‘æå–æœªå®Œæˆçš„ä»»åŠ¡æˆ–æ‰¿è¯º
ã€æ€»ç»“ã€‘ä¸€å¥è¯æ¦‚æ‹¬

{{messages}}</pre>
                        </div>
                    </details>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="summarizer-section">
                    <h4><i class="fa-solid fa-tools"></i> æ“ä½œ</h4>
                    
                    <div class="summarizer-actions">
                        <button id="summarizer_generate" 
                                class="menu_button" 
                                title="ç«‹å³ç”Ÿæˆå½“å‰èŠå¤©çš„æ€»ç»“">
                            <i class="fa-solid fa-play"></i> ç”Ÿæˆæ€»ç»“
                        </button>
                        
                        <button id="summarizer_view" 
                                class="menu_button" 
                                title="æŸ¥çœ‹å½“å‰æ€»ç»“å†…å®¹"
                                style="display: none;">
                            <i class="fa-solid fa-eye"></i> æŸ¥çœ‹æ€»ç»“
                        </button>
                        
                        <button id="summarizer_import" 
                                class="menu_button" 
                                title="ä»æ–‡ä»¶å¯¼å…¥æ€»ç»“">
                            <i class="fa-solid fa-upload"></i> å¯¼å…¥æ€»ç»“
                        </button>
                        
                        <button id="summarizer_export" 
                                class="menu_button" 
                                title="å¯¼å‡ºæ€»ç»“ä¸ºæ–‡æœ¬æ–‡ä»¶"
                                style="display: none;">
                            <i class="fa-solid fa-download"></i> å¯¼å‡ºæ€»ç»“
                        </button>
                        
                        <button id="summarizer_clear" 
                                class="menu_button menu_button_icon" 
                                title="æ¸…é™¤å½“å‰èŠå¤©çš„æ€»ç»“"
                                style="display: none;">
                            <i class="fa-solid fa-trash"></i> æ¸…é™¤
                        </button>
                    </div>
                    
                    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                    <input type="file" 
                           id="summarizer_import_file" 
                           accept=".txt,.md" 
                           style="display: none;">
                </div>

                <!-- ä½¿ç”¨è¯´æ˜ -->
                <div class="summarizer-section">
                    <details>
                        <summary><i class="fa-solid fa-question-circle"></i> ä½¿ç”¨è¯´æ˜</summary>
                        <div class="summarizer-help">
                            <h5>åŠŸèƒ½è¯´æ˜</h5>
                            <ul>
                                <li><strong>ç”Ÿæˆæ€»ç»“:</strong> ç‚¹å‡»"ç”Ÿæˆæ€»ç»“"æŒ‰é’®,ç«‹å³å¯¹å½“å‰èŠå¤©è®°å½•ç”Ÿæˆæ€»ç»“</li>
                                <li><strong>è‡ªåŠ¨æ€»ç»“:</strong> å¯ç”¨å,æ¯å½“æ–°æ¶ˆæ¯æ•°è¾¾åˆ°è®¾å®šé—´éš”æ—¶è‡ªåŠ¨ç”Ÿæˆæ€»ç»“</li>
                                <li><strong>åˆ†æ‰¹å¤„ç†:</strong> å¯¹äºé•¿å¯¹è¯,æ’ä»¶ä¼šè‡ªåŠ¨åˆ†æ‰¹æ€»ç»“å†æ±‡æ€»,æé«˜å‡†ç¡®æ€§</li>
                                <li><strong>å¯¼å…¥æ€»ç»“:</strong> å¯ä»¥å¯¼å…¥ä¹‹å‰å¯¼å‡ºçš„æ€»ç»“æ–‡ä»¶,æ”¯æŒå¤šç§æ ¼å¼</li>
                                <li><strong>å¯¼å‡ºæ€»ç»“:</strong> å¯¼å‡ºçš„æ–‡ä»¶åŒ…å«å®Œæ•´å…ƒæ•°æ®,æ–¹ä¾¿åç»­å¯¼å…¥</li>
                                <li><strong>èŠå¤©æ˜¾ç¤º:</strong> å¯é€‰æ‹©åœ¨èŠå¤©ç•Œé¢é¡¶éƒ¨æˆ–åº•éƒ¨æ˜¾ç¤ºæ€»ç»“å†…å®¹</li>
                            </ul>

                            <h5>å¯¼å…¥/å¯¼å‡º</h5>
                            <ul>
                                <li><strong>å¯¼å‡ºæ ¼å¼:</strong> å¯¼å‡ºçš„æ–‡ä»¶åŒ…å«è§’è‰²åã€æ—¶é—´æˆ³ã€æ¶ˆæ¯æ•°ç­‰å…ƒæ•°æ®</li>
                                <li><strong>å¯¼å…¥å…¼å®¹:</strong> æ”¯æŒå¯¼å…¥æœ¬æ’ä»¶å¯¼å‡ºçš„æ–‡ä»¶,ä¹Ÿå°è¯•å…¼å®¹å…¶ä»–æ ¼å¼</li>
                                <li><strong>è¦†ç›–æé†’:</strong> å¯¼å…¥å‰ä¼šæç¤ºæ˜¯å¦è¦†ç›–ç°æœ‰æ€»ç»“</li>
                                <li><strong>çº¯æ–‡æœ¬ä¹Ÿå¯:</strong> å³ä½¿æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ä¹Ÿèƒ½å°è¯•å¯¼å…¥</li>
                            </ul>

                            <h5>æœ€ä½³å®è·µ</h5>
                            <ul>
                                <li>å»ºè®®æ¯20-50æ¡æ¶ˆæ¯ç”Ÿæˆä¸€æ¬¡æ€»ç»“</li>
                                <li>ä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯è·å¾—ç¬¦åˆéœ€æ±‚çš„æ€»ç»“æ ¼å¼</li>
                                <li>å®šæœŸå¯¼å‡ºæ€»ç»“,é¿å…æ•°æ®ä¸¢å¤±</li>
                                <li>æ€»ç»“å†…å®¹ä¼šéšèŠå¤©æ–‡ä»¶è‡ªåŠ¨ä¿å­˜</li>
                                <li>å¯ä»¥åœ¨ä¸åŒèŠå¤©é—´å¯¼å…¥å¯¼å‡ºæ€»ç»“</li>
                            </ul>

                            <h5>æŠ€å·§</h5>
                            <ul>
                                <li>ğŸ’¡ å¯¹äºRPGæ¸¸æˆ,å¯ä»¥ç”¨"äº‹ä»¶æ—¥å¿—"é£æ ¼çš„æç¤ºè¯</li>
                                <li>ğŸ’¡ å¯¹äºå­¦ä¹ å¯¹è¯,å¯ä»¥ç”¨"çŸ¥è¯†è¦ç‚¹"é£æ ¼çš„æç¤ºè¯</li>
                                <li>ğŸ’¡ å¯¹äºæ•…äº‹åˆ›ä½œ,å¯ä»¥ç”¨"å‰§æƒ…å¤§çº²"é£æ ¼çš„æç¤ºè¯</li>
                                <li>ğŸ’¡ å¯¼å‡ºçš„æ€»ç»“å¯ä»¥ä½œä¸ºè§’è‰²å¡çš„è¡¥å……è¯´æ˜</li>
                            </ul>
                        </div>
                    </details>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.summarizer-section {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--SmartThemeBorderColor);
}

.summarizer-section:last-child {
    border-bottom: none;
}

.summarizer-section h4 {
    margin: 0 0 0.5rem 0;
    color: var(--SmartThemeQuoteColor);
    font-size: 1em;
}

.summarizer-status-box {
    padding: 0.75rem;
    background: var(--SmartThemeBlurTintColor);
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.summarizer-status-box i {
    color: var(--SmartThemeQuoteColor);
}

.range-block {
    margin-top: 0.75rem;
}

.range-block label {
    display: block;
    margin-bottom: 0.25rem;
}

.range-slider {
    width: 100%;
    margin: 0.5rem 0;
}

.help-text {
    display: block;
    color: var(--SmartThemeEmColor);
    font-size: 0.9em;
    margin-top: 0.25rem;
}

.summarizer-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
}

.summarizer-actions button {
    width: 100%;
}

.example-prompts {
    margin-top: 0.5rem;
    padding: 0.75rem;
    background: var(--black10a);
    border-radius: 4px;
    font-size: 0.9em;
}

.example-prompts p {
    margin: 0.5rem 0 0.25rem 0;
}

.example-prompts pre {
    background: var(--black20a);
    padding: 0.5rem;
    border-radius: 4px;
    white-space: pre-wrap;
    word-wrap: break-word;
    margin: 0.25rem 0 0.75rem 0;
}

.summarizer-help {
    padding: 0.75rem;
    background: var(--SmartThemeBlurTintColor);
    border-radius: 6px;
    margin-top: 0.5rem;
}

.summarizer-help h5 {
    margin: 0.5rem 0;
    color: var(--SmartThemeQuoteColor);
}

.summarizer-help ul {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.summarizer-help li {
    margin: 0.25rem 0;
}

/* èŠå¤©ç•Œé¢ä¸­çš„æ€»ç»“æ˜¾ç¤º */
.chat-summary-display {
    margin: 1rem 0;
    padding: 1rem;
    background: linear-gradient(135deg, 
        var(--SmartThemeBlurTintColor) 0%, 
        var(--black10a) 100%);
    border-left: 4px solid var(--SmartThemeQuoteColor);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.chat-summary-display .summary-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    color: var(--SmartThemeQuoteColor);
    font-size: 1.1em;
}

.chat-summary-display .summary-info {
    font-size: 0.85em;
    color: var(--SmartThemeEmColor);
    margin-left: auto;
}

.chat-summary-display .summary-body {
    padding: 0.75rem;
    background: var(--black10a);
    border-radius: 6px;
    line-height: 1.6;
    margin-bottom: 0.5rem;
}

.chat-summary-display .summary-footer {
    text-align: right;
    color: var(--SmartThemeEmColor);
    font-size: 0.85em;
}

/* æŸ¥çœ‹æ€»ç»“å¼¹çª—æ ·å¼ */
.summary-viewer {
    padding: 1rem;
    max-height: 70vh;
    overflow-y: auto;
}

.summary-viewer .summary-header {
    padding: 0.75rem;
    background: var(--SmartThemeBlurTintColor);
    border-radius: 6px;
    margin-bottom: 1rem;
}

.summary-viewer .summary-content {
    padding: 1rem;
    background: var(--black10a);
    border-radius: 6px;
    line-height: 1.8;
    white-space: pre-wrap;
    word-wrap: break-word;
}
</style>